<!-- Never set as relative, while we use kendo tile layouts for widget grid
  todo(2.1.x): check if h-full should be removed -->
<div class="w-full flex h-full">
  <!-- SIDENAV CONTENT -->
  <div class="flex items-center">
    <ng-container *ngFor="let sidenav of uiSidenavDirective; let i = index">
      <!-- ngStyle prevent the left sidenav to have a fixed height -->
      <div
        #sidenav
        class="will-change-transform overflow-y-auto overflow-x-clip"
        [attr.data-sidenav-show]="showSidenav[i]"
        [ngClass]="resolveSidenavClasses(i)"
        [ngStyle]="{
          width:
            sidenav.position === 'start'
              ? showSidenav[i]
                ? SIDENAV_WIDTH_PX.expanded
                : SIDENAV_WIDTH_PX.collapsed
              : 'auto'
        }"
        (mouseenter)="onMouseEnter(i)"
        (mouseleave)="onMouseLeave(i)"
      >
        <div class="flex flex-col h-full"></div>
      </div>

      <!-- Collapse button -->
      <ng-container
        *ngIf="sidenav.position === 'start' && !horizontalNavTemplate"
      >
        <ng-container
          *ngTemplateOutlet="
            collapseButtonTemplate;
            context: { $implicit: sidenav, index: i }
          "
        ></ng-container>
      </ng-container>
    </ng-container>
  </div>

  <div class="flex flex-col w-full">
    <!-- HEADER -->
    <ng-container *ngIf="headerTemplate">
      <ng-container [ngTemplateOutlet]="headerTemplate"></ng-container>
      <ng-container
        *ngIf="horizontalNavTemplate"
        [ngTemplateOutlet]="horizontalNavTemplate"
      ></ng-container>
    </ng-container>

    <div
      class="flex-1 w-full overflow-clip bg-light-50"
      #contentContainer
      [ngStyle]="{
        'padding-left':
          largeDevice || horizontalNavTemplate ? 0 : SIDENAV_WIDTH_PX.collapsed
      }"
    >
      <!-- Backdrop -->
      <div
        [ngClass]="{
          'visible bg-black opacity-50': showSidenav[0] && mode[0] === 'over',
          'invisible bg-transparent': !showSidenav[0] || mode[0] === 'side'
        }"
        class="block w-full overflow-y-auto min-h-full transition-visibility duration-500 transition-all ease-in-out absolute inset-0 pointer-events-none z-[1001]"
      ></div>
      <div class="h-full w-full relative">
        <!-- Page wrapper -->
        <div
          [ngClass]="resolveContentWrapperClasses()"
          id="appPageContainer"
          #contentWrapper
        >
          <ng-content select="content"></ng-content>
        </div>
      </div>
    </div>
    <ng-template #fixedWrapperActions></ng-template>
  </div>
</div>

<!-- Collapse button template -->
<ng-template #collapseButtonTemplate let-sidenav let-indexNav="index">
  <!-- Show/collapse button -->
  <div
    #collapseButtonWrapper
    class="h-11 w-11 flex absolute items-center z-[1003] justify-center"
    (mouseenter)="onMouseEnter(indexNav)"
    (mouseleave)="onMouseLeave(indexNav)"
    [ngStyle]="{
      transform: showSidenav[indexNav]
        ? 'translateX(calc(' + SIDENAV_WIDTH_PX.expanded + ' - 50%))'
        : 'translateX(calc(' + SIDENAV_WIDTH_PX.collapsed + ' - 50%))'
    }"
  >
    <div
      class="transition-all duration-150 ease-in-out"
      [ngClass]="{
        'opacity-0 invisible': !sidenavHovered[indexNav],
        'opacity-100 visible': sidenavHovered[indexNav]
      }"
    >
      <ui-button
        variant="lighter"
        [isIcon]="true"
        size="medium"
        [icon]="
          showSidenav[indexNav] ? 'arrow_back_ios_new' : 'arrow_forward_ios'
        "
        (click)="toggleSidenav(indexNav)"
      >
      </ui-button>
    </div>
  </div>
</ng-template>
