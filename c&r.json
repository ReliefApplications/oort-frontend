{
  "logoPosition": "right",
  "pages": [
    {
      "name": "page1",
      "elements": [
        {
          "type": "expression",
          "name": "author_org",
          "visible": false,
          "title": "author_org",
          "valueName": "author_org",
          "clearIfInvisible": "none",
          "omitField": true,
          "expression": "iif({user.roles} contains \"6772985a2fc2a0c65c171373\", \"Advisory Committee\",\niif({user.roles} contains \"6772987b2fc2a0c65c1713ec\", \"MAB Secretariat\",\niif({user.roles} contains \"677298832fc2a0c65c171418\", \"Biosphere Reserve Manager\",\niif({user.roles} contains \"6772988c2fc2a0c65c171444\", \"National Commission\",\niif({user.roles} contains \"677298962fc2a0c65c171470\", \"Bureau (ICC)\",\niif({user.roles} contains \"677298a12fc2a0c65c17149c\", \"External Reviewer\", \"Other\"))))))"
        },
        {
          "type": "expression",
          "name": "can_add_comments",
          "visible": false,
          "title": "can_add_comments",
          "valueName": "can_add_comments",
          "clearIfInvisible": "none",
          "omitField": true,
          "expression": "{author_org} == \"MAB Secretariat\" and {form_status} == \"Submitted for technical comments\" or\n{author_org} == \"Advisory Committee\" and {form_status} == \"Submitted for Advisory Committee review\" or\n{author_org} == \"Bureau (ICC)\" and {form_status} == \"Edited for Bureau review\" or\n{author_org} == \"Bureau (ICC)\" and {form_status} == \"Recommended for approval\" or\n{author_org} == \"Bureau (ICC)\" and {form_status} == \"Recommended for deferral\""
        },
        {
          "type": "text",
          "name": "form_status",
          "visible": false,
          "title": "form_status",
          "valueName": "form_status",
          "clearIfInvisible": "none",
          "omitField": true
        },
        {
          "type": "text",
          "name": "selected_question",
          "visible": false,
          "title": "Relevant question",
          "valueName": "selected_question",
          "resetValueIf": "{clear_selected_question} = 'all'",
          "omitField": true
        },
        {
          "type": "boolean",
          "name": "comments_or_recommendation",
          "titleLocation": "hidden",
          "valueName": "comments_or_recommendation",
          "defaultValue": "false",
          "omitField": true,
          "labelTrue": "Recommendations",
          "labelFalse": "Comments"
        },
        {
          "type": "rating",
          "name": "clear_selected_question",
          "visible": false,
          "visibleIf": "{selected_question} notempty",
          "minWidth": "100%",
          "maxWidth": "fit-content",
          "title": "Teste",
          "titleLocation": "hidden",
          "valueName": "clear_selected_question",
          "omitField": true,
          "autoGenerate": false,
          "rateCount": 1,
          "rateValues": [
            {
              "value": "all",
              "text": "Show all"
            }
          ]
        },
        {
          "type": "html",
          "name": "comments_instructions",
          "visibleIf": "{comments_or_recommendation} = false",
          "valueName": "comments_instructions",
          "html": "Enter here requests for changes and/or more information for the biosphere reserve to address."
        },
        {
          "type": "html",
          "name": "recommendations_instructions",
          "visibleIf": "{comments_or_recommendation} = true",
          "valueName": "recommendations_instructions",
          "html": "Enter here the formal recommendation that will be shared with the MAB-ICC to inform their decision."
        },
        {
          "type": "paneldynamic",
          "name": "comments",
          "visibleIf": "{comments_or_recommendation} = false",
          "maxWidth": "",
          "title": "Comments",
          "titleLocation": "hidden",
          "valueName": "comments",
          "clearIfInvisible": "none",
          "templateElements": [
            {
              "type": "html",
              "name": "question2",
              "html": "<div style=\"display: flex; flex-direction: column\">\n  <div style=\"display: flex; width: 100%; justify-content: space-between\">\n    <span style=\"font-size: 14px; font-weight: 600\">{panel.author_name}</span>\n    <div style=\"display: flex; gap: 4px; align-items: center\">\n      <label\n        for=\"editComment-{panelIndex}\"\n        style=\"\n          background: transparent;\n          border: none;\n          cursor: pointer;\n          font-size: 14px;\n        \"\n        >✏️</label\n      >\n      <input\n        checke{panel.comment}d\n        type=\"checkbox\"\n        id=\"editComment-{panelIndex}\"\n        style=\"display: none\"\n      />\n      <span style=\"font-size: 12px; font-weight: 400; opacity: 0.6\"\n        >{panel.time}</span\n      >\n    </div>\n  </div>\n  <div\n    style=\"\n      padding: 0px 6px;\nopacity: 0.7;\n      width: fit-content;\n      background-color: lightgray;\n      border-radius: 4px; margin-bottom: 12px;\n    \"\n  >\n    <p style=\"margin: 0; color: #2b2b2b; font-size: 0.8em; line-height:2\">\n      {panel.comment_question}\n    </p>\n  </div>\n\n  <div style=\"font-size: 14px; line-height: 1.3\">{panel.comment}</div>\n</div>\n"
            },
            {
              "type": "users",
              "name": "author",
              "visible": false,
              "title": "Author",
              "titleLocation": "top",
              "valueName": "author",
              "defaultValueExpression": "{user.id}",
              "clearIfInvisible": "none",
              "selectMultiple": false
            },
            {
              "type": "text",
              "name": "timestamp",
              "visible": false,
              "startWithNewLine": false,
              "title": "Timestamp",
              "titleLocation": "top",
              "valueName": "timestamp",
              "setValueIf": "{panel.comment} notempty",
              "setValueExpression": "currentDate()",
              "clearIfInvisible": "none",
              "readOnly": true,
              "inputType": "datetime-local"
            },
            {
              "type": "expression",
              "name": "author_is_editing",
              "visible": false,
              "title": "author_is_editing",
              "titleLocation": "top",
              "valueName": "author_is_editing",
              "clearIfInvisible": "onComplete",
              "omitField": true,
              "expression": "{panel.author} == [{user.id}]"
            },
            {
              "type": "text",
              "name": "author_name",
              "visible": false,
              "title": "author_name",
              "titleLocation": "top",
              "valueName": "author_name",
              "defaultValueExpression": "{author_org}",
              "clearIfInvisible": "none"
            },
            {
              "type": "text",
              "name": "comment_question",
              "visible": false,
              "title": "comment_question",
              "titleLocation": "top",
              "valueName": "comment_question",
              "clearIfInvisible": "none",
              "valueExpression": "iif({panel.comment_question} empty, {selected_question}, {panel.comment_question})"
            },
            {
              "type": "expression",
              "name": "time",
              "visible": false,
              "title": "time",
              "titleLocation": "top",
              "valueName": "time",
              "clearIfInvisible": "none",
              "expression": "iif({panel.timestamp} empty, \"\", iif(addDays(getDate({panel.timestamp}) , 1) < currentDate(), formatDateTime({panel.timestamp}, \"%d/%m/%y\"), formatDateTime({panel.timestamp}, \"%H:%M\")))\n\n\n"
            },
            {
              "type": "expression",
              "name": "num_of_replies",
              "visible": false,
              "title": "num_of_replies",
              "titleLocation": "top",
              "valueName": "num_of_replies",
              "omitField": true,
              "expression": "length({panel.replies})"
            },
            {
              "type": "comment",
              "name": "comment",
              "title": "Comment",
              "titleLocation": "hidden",
              "valueName": "comment",
              "enableIf": "{panel.num_of_replies}",
              "clearIfInvisible": "none",
              "isRequired": true,
              "placeholder": "Type your comment...",
              "allowResize": false
            },
            {
              "type": "paneldynamic",
              "name": "replies",
              "state": "collapsed",
              "visibleIf": "length({panel.replies}) > 0 or !{can_add_comments}",
              "maxWidth": "750px",
              "title": "Replies ({panel.num_of_replies})",
              "titleLocation": "top",
              "valueName": "replies",
              "clearIfInvisible": "none",
              "templateElements": [
                {
                  "type": "html",
                  "name": "question2",
                  "html": "<div style=\"display: flex; flex-direction: column\"> \n\n<div style=\"display: flex; width:100%; justify-content: space-between;\">\n<span style=\"font-size: 14px; font-weight: 600\">{panel.author_name}</span>\n<div style=\"display: flex; gap: 4px; align-items: center;\">\n  <label for=\"editComment-reply-{panel.timestamp}-{panelIndex}-{panel.author}\" style=\"background: transparent; border: none; cursor: pointer; font-size: 14px;\">✏️</label>\n  <input checke{panel.comment}d type=\"checkbox\" id=\"editComment-reply-{panel.timestamp}-{panelIndex}-{panel.author}\" style=\"display: none;\">\n  <span style=\"font-size: 12px; font-weight: 400; opacity: 0.6\">{panel.time}</span>\n</div>\n</div>\n\n<div style=\"font-size: 14px; line-height: 1.3\">{panel.comment}</div>\n\n</div>"
                },
                {
                  "type": "users",
                  "name": "author",
                  "visible": false,
                  "title": "Author",
                  "titleLocation": "top",
                  "valueName": "author",
                  "defaultValueExpression": "{user.id}",
                  "clearIfInvisible": "none",
                  "selectMultiple": false
                },
                {
                  "type": "text",
                  "name": "timestamp",
                  "visible": false,
                  "startWithNewLine": false,
                  "title": "Timestamp",
                  "titleLocation": "top",
                  "valueName": "timestamp",
                  "setValueIf": "{panel.comment} notempty",
                  "setValueExpression": "currentDate()",
                  "clearIfInvisible": "none",
                  "readOnly": true,
                  "inputType": "datetime-local"
                },
                {
                  "type": "expression",
                  "name": "author_is_editing",
                  "visible": false,
                  "title": "author_is_editing",
                  "titleLocation": "top",
                  "valueName": "author_is_editing",
                  "omitField": true,
                  "expression": "{panel.author} == [{user.id}]"
                },
                {
                  "type": "text",
                  "name": "author_name",
                  "visible": false,
                  "title": "author_name",
                  "titleLocation": "top",
                  "valueName": "author_name",
                  "defaultValueExpression": "{author_org}",
                  "clearIfInvisible": "none",
                  "omitField": true
                },
                {
                  "type": "expression",
                  "name": "time",
                  "visible": false,
                  "title": "time",
                  "titleLocation": "top",
                  "valueName": "time",
                  "clearIfInvisible": "none",
                  "expression": "iif({panel.timestamp} empty, \"\", iif(addDays(getDate({panel.timestamp}) , 1) < currentDate(), formatDateTime({panel.timestamp}, \"%d/%m/%y\"), formatDateTime({panel.timestamp}, \"%H:%M\")))\n\n\n"
                },
                {
                  "type": "comment",
                  "name": "comment",
                  "title": "Comment",
                  "titleLocation": "hidden",
                  "valueName": "comment",
                  "enableIf": "{panel.num_of_replies}",
                  "clearIfInvisible": "none",
                  "isRequired": true,
                  "placeholder": "Type your comment...",
                  "textUpdateMode": "onBlur",
                  "allowResize": false
                }
              ],
              "noEntriesText": "No comments yet.",
              "newPanelPosition": "next",
              "panelsState": "collapsed",
              "confirmDelete": true,
              "confirmDeleteText": "Are you sure you want to delete this comment?",
              "panelAddText": "Add reply",
              "panelRemoveText": "Delete reply",
              "allowRemovePanelExpression": "{panel.author_name} = {author_org}"
            }
          ],
          "noEntriesText": "No comments yet.",
          "newPanelPosition": "next",
          "confirmDelete": true,
          "confirmDeleteText": "Are you sure you want to delete this comment?",
          "panelAddText": "Add new comment",
          "panelRemoveText": "Delete comment",
          "templateVisibleIf": "{selected_question} empty or {panel.comment_question} = {selected_question}",
          "allowRemovePanelExpression": "{panel.author_name} = {author_org}",
          "startOnLastElement": true,
          "sortBySubQuestion": "comment_question"
        },
        {
          "type": "paneldynamic",
          "name": "recommendations",
          "visible": false,
          "visibleIf": "{comments_or_recommendation} = true",
          "maxWidth": "",
          "title": "Recommendations",
          "titleLocation": "hidden",
          "valueName": "recommendations",
          "clearIfInvisible": "none",
          "templateElements": [
            {
              "type": "users",
              "name": "author",
              "visible": false,
              "title": "Author",
              "titleLocation": "top",
              "valueName": "author",
              "defaultValueExpression": "{user.id}",
              "clearIfInvisible": "none",
              "selectMultiple": false
            },
            {
              "type": "text",
              "name": "timestamp",
              "visible": false,
              "startWithNewLine": false,
              "title": "Timestamp",
              "titleLocation": "top",
              "valueName": "timestamp",
              "setValueIf": "{panel.question20} notempty",
              "setValueExpression": "currentDate()",
              "clearIfInvisible": "none",
              "readOnly": true,
              "inputType": "datetime-local"
            },
            {
              "type": "text",
              "name": "author_name",
              "visible": false,
              "title": "author_name",
              "titleLocation": "top",
              "valueName": "author_name",
              "defaultValueExpression": "{author_org}",
              "clearIfInvisible": "none",
              "readOnly": true
            },
            {
              "type": "expression",
              "name": "recommendation_status_choices",
              "visible": false,
              "valueName": "recommendation_status_choices",
              "valueExpression": "iif({panel.author_name} == \"MAB Secretariat\",[\"Dossier complete\",\"More information needed\"],iif({panel.author_name} == \"Advisory Committee\",[\"Recommended for approval\",\"Recommended for approval, pending comments\",\"Recommended for deferral\"],iif({panel.author_name} == \"Bureau (ICC)\",[\"Approved\",\"Deferred\"],[])))",
              "omitField": true,
              "omitOnXlsxTemplate": true
            },
            {
              "type": "radiogroup",
              "name": "recommendation_status",
              "valueName": "recommendation_status",
              "clearIfInvisible": "none",
              "isRequired": true,
              "choicesExpression": "{panel.recommendation_status_choices}"
            },
            {
              "type": "comment",
              "name": "comment",
              "visibleIf": "{panel.author_name} != \"Bureau (ICC)\"",
              "title": "Comment",
              "titleLocation": "hidden",
              "valueName": "comment",
              "clearIfInvisible": "none",
              "isRequired": true,
              "placeholder": "Type your recommendation...",
              "textUpdateMode": "onBlur",
              "allowResize": false
            }
          ],
          "templateTabTitle": "{panel.author_name}",
          "noEntriesText": "No recommendations yet.",
          "allowRemovePanel": false,
          "newPanelPosition": "next",
          "confirmDelete": true,
          "confirmDeleteText": "Are you sure you want to delete this recommendation?",
          "panelAddText": "Add new recommendation",
          "panelRemoveText": "Delete recommendation",
          "showRangeInProgress": false,
          "renderMode": "tab",
          "tabAlign": "left",
          "allowAddPanelExpression": "{can_add_comments}",
          "allowRemovePanelExpression": "{panel.author_name} = {author_org}",
          "startOnLastElement": true
        }
      ],
      "title": "Comments"
    }
  ],
  "triggers": [
    {
      "type": "runexpression",
      "expression": "{clear_selected_question} = 'all'",
      "setToName": "clear_selected_question",
      "runExpression": "\"item1\""
    }
  ],
  "showPageTitles": false,
  "showQuestionNumbers": "off",
  "hidePagesTab": true,
  "autoSave": true
}
