<form [formGroup]="settingsForm" *ngIf="settingsForm">
  <!-- Header -->
  <div class="flex gap-2 flex-wrap justify-between items-start">
    <div class="flex items-center gap-1">
      <h1 class="!m-0">{{ 'common.general' | translate }}</h1>
      <!-- Access -->
      <shared-access
        [access]="application?.permissions"
        [objectTypeName]="'common.application.one' | translate"
        (save)="saveAccess($event)"
      ></shared-access>
    </div>
    <!-- Selection of status -->
    <div uiFormFieldDirective [outline]="false" class="p-0">
      <label>{{ 'common.status' | translate }}</label>
      <ui-select-menu
        formControlName="status"
        [customTemplate]="{
          template: statusTemplate,
          context: { $implicit: settingsForm.get('status')!.value }
        }"
      >
        <ui-select-option *ngFor="let status of statusChoices" [value]="status">
          <ng-container
            *ngTemplateOutlet="statusTemplate; context: { $implicit: status }"
          ></ng-container>
        </ui-select-option>
      </ui-select-menu>
    </div>
  </div>

  <div class="bg-white rounded-xl p-6">
    <!-- Main two-column layout -->
    <div class="grid grid-cols-2 gap-6">
      <!-- Left column -->
      <div class="flex flex-col gap-6">
        <!-- Name -->
        <div uiFormFieldDirective>
          <label>{{ 'common.name' | translate }}</label>
          <input
            formControlName="name"
            type="text"
            [placeholder]="'common.placeholder.name' | translate"
            class="w-full"
          />
        </div>

        <!-- ID -->
        <div uiFormFieldDirective>
          <label>{{ 'models.application.id' | translate }}</label>
          <input formControlName="id" type="text" class="w-full" />
        </div>

        <!-- Toggles -->
        <div class="flex gap-4">
          <!-- Side menu toggle -->
          <ui-toggle formControlName="sideMenu">
            <ng-container ngProjectAs="label">{{
              'components.application.update.sideMenu' | translate
            }}</ng-container>
          </ui-toggle>

          <!-- Hide menu toggle -->
          <ui-toggle formControlName="hideMenu">
            <ng-container ngProjectAs="label">
              {{ 'components.application.update.hideMenu' | translate }}
              <ui-icon
                class="ml-1 cursor-help self-center"
                variant="grey"
                [size]="18"
                icon="info_outline"
                [uiTooltip]="
                  'components.application.update.tooltip.hideMenu' | translate
                "
              ></ui-icon>
            </ng-container>
          </ui-toggle>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-2 mt-auto">
          <ui-button
            *ngIf="application && application.canUpdate"
            category="secondary"
            variant="primary"
            (click)="onOpenStyle()"
          >
            {{ 'components.application.customStyling' | translate }}
          </ui-button>
          <ui-button
            icon="file_copy"
            category="tertiary"
            variant="primary"
            (click)="onDuplicate()"
            *ngIf="'create' | able : 'Application'"
          >
            {{ 'common.duplicate' | translate }}
          </ui-button>
          <ui-button
            icon="delete"
            category="tertiary"
            variant="danger"
            (click)="onDelete()"
            *ngIf="application && application.canDelete"
          >
            {{ 'common.delete' | translate }}
          </ui-button>
        </div>
      </div>

      <!-- Right column -->
      <div class="flex flex-col gap-6">
        <!-- Description -->
        <div uiFormFieldDirective>
          <label>{{ 'models.application.description' | translate }}</label>
          <ui-textarea
            formControlName="description"
            [placeholder]="
              'components.application.update.placeholder.description'
                | translate
            "
            [minRows]="2"
            [maxRows]="5"
            name="textarea"
            class="w-full"
          ></ui-textarea>
        </div>

        <!-- Logo and Upload -->
        <div *ngIf="application && application.canUpdate">
          <div class="flex items-center">
            <label class="text-sm font-medium text-neutral-850">{{
              'common.logo.one' | translate
            }}</label>
            <ui-icon
              class="ml-1 cursor-help self-center"
              variant="grey"
              [size]="18"
              icon="info_outline"
              [uiTooltip]="
                'components.application.update.tooltip.logo' | translate
              "
            ></ui-icon>
          </div>

          <div class="flex items-center h-28" *ngIf="loadingLogo || logoBase64">
            <ui-spinner *ngIf="loadingLogo"></ui-spinner>
            <div *ngIf="logoBase64 && !loadingLogo">
              <label
                class="block text-xs font-medium leading-6 text-neutral-600"
                >{{
                  'components.application.update.logo.current' | translate
                }}</label
              >
              <div class="flex items-center gap-2">
                <img
                  class="h-14 w-14 object-contain"
                  [src]="logoBase64"
                  alt="Application Logo"
                />
                <button (click)="onDeleteLogo()">
                  <ui-icon icon="delete" variant="danger"></ui-icon>
                </button>
              </div>
            </div>
          </div>

          <!-- Upload Logo -->
          <label class="text-sm font-medium text-neutral-850">
            {{ 'components.application.update.logo.upload' | translate }}
          </label>
          <kendo-upload
            class="w-full upload-clip mt-1"
            name="Upload logo"
            [restrictions]="{ maxFileSize: MAX_FILE_SIZE_MB * 1024 * 1024 }"
            (upload)="onUpload($event)"
            [accept]="extensions"
            [multiple]="false"
          ></kendo-upload>
        </div>
      </div>
    </div>
  </div>
</form>

<!-- Floating div for actions buttons -->
<ui-fixed-wrapper>
  <!-- Save button -->
  <ui-button
    category="secondary"
    variant="primary"
    (click)="onSubmit()"
    [disabled]="settingsForm.invalid || !settingsForm.dirty"
  >
    {{ 'common.saveChanges' | translate }}
  </ui-button>
</ui-fixed-wrapper>
<ng-template #statusTemplate let-status>
  <shared-status-options [status]="status"></shared-status-options>
</ng-template>
